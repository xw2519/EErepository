\documentclass[10pt, a4paper]{article}
\usepackage{amsmath}  % improve math presentation
\usepackage{graphicx} % takes care of graphic including machinery
\usepackage[a4paper, top=2.5cm, bottom=2.5cm, left=2.2cm, right=2.2cm]{geometry}
\usepackage{listings}
\usepackage{color} %red, green, blue, yellow, cyan, magenta, black, white

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\definecolor{mygreen}{RGB}{28,172,0} % color values Red, Green, Blue
\definecolor{mylilas}{RGB}{170,55,241}

\lstset
{
    language=Matlab,%
    %basicstyle=\color{red},
    breaklines=true,%
    morekeywords={matlab2tikz},
    keywordstyle=\color{blue},%
    morekeywords=[2]{1}, keywordstyle=[2]{\color{black}},
    identifierstyle=\color{black},%
    stringstyle=\color{mylilas},
    commentstyle=\color{mygreen},%
    showstringspaces=false,%without this there will be a symbol in the places where there is a space
    numbers=left,%
    numberstyle={\tiny \color{black}},% size of the numbers
    numbersep=9pt, % this defines how far the numbers are from the text
    emph=[1]{for,end,break},emphstyle=[1]\color{red}, %some words to emphasise
    %emph=[2]{word1,word2}, emphstyle=[2]{style},    
}

\setlength{\parskip}{1em}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title{
    Mathematics - Numerical Analysis \\ \large Problem Sheet 2: Heun’s Method and Second Order ODE}
\author{Xin Wang}
\maketitle
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}
Here is the Matlab code used to evaluate Euler’s method, seen in class.
\begin{verbatim}
    x=0; % set initial value of x0
    y=2; % set y initial condition y at x0
    h=0.006; % set step-size
    xf=1; % set final value of x
    N=round((xf-x)/h); % nr of steps:  (interval size)/(step size)
    plot(x,y,’*’); % plot initial condition
    hold on; % figure open for more data

    for j=1:N % loop for N steps
        yp=y + h*(x+y); % predictor for next value of y
        grad1=x+y; % gradient at x
        grad2=x+h+yp; % gradient at x+h
        yave=0.5*(grad1+grad2); % average gradient over [x,x+h]
        y=y+h*yave; % new y from euler, using yave as gradient
        x=x+h; % increase x by stepsize
        plot(x,y, ’b*’) % plot new values of x,y
    end

    xx=0:h:xf; %same interval, stepsize
    yy=3*exp(xx)-xx-1; %calculate exact solution
    plot(xx,yy,’r’); %plot exact solution
\end{verbatim}   
    

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Exercise 1}

Repeat the procedure of the trapeze examples with the Euler method for the differential equation:
$$
    \frac{dy}{dx} = x+y \; \text{with initial condition }y(0) = 2
$$
on $[0,1]$, whose solution is in the notes. Experiment first with the above code, see if you can come up with improvements.  
\begin{itemize}
    \item Consider the output you want. In the trapeze example we compared two single numbers, the
    exact and approximate values of the integral. In this case we are approximating the value of the
    function $y(x) \; \text{for } x\in[0,1]$. In fact, we want to plot $y(x)$ on $[0,1]$, as the very
    simple code above does. Similarly, for error analysis, we have to compare the estimated values to the
    exact solution at the correct value of $x$ in the interval $[0,1]$, as the simple code above
    does.  
    
    You will need to compare two arrays of values, obtaining an array of errors. For this function we
    expect the maximum error at the end, at $x=1$ because $y(x)$ is monotone increasing on the
    interval considered. This cannot be assumed: The error we seek needs to be the maximal error
    found.
    \begin{enumerate}
        \item Declare arrays of values $y$ and $x$ of length $N$ (see above) with entries $x_i$ for
        $i= 0...(N-1)$ and $x_0$, $y_0$ is the initial condition. The entries for the x-array should have
        spacing $h$. Use the Euler method to fill in the values of $y$ for each $x_i>x_0$.

        \item Declare a function handle $f(x,y)$ so you can use the function in the loop. (This will
        make it easier in $(b)$ to pass a function as an argument in the function call to the matlab
        function \textit{euler.m})  The syntax for \textit{feval} extends logically from functions
        of one variable to functions of two variables.

        \item Calculate an array of exact solutions using $y= 3e^x-x-1$, ensuring that it matches
        the entries in the x-array.

        \item Now you can subtract the two solution arrays and obtain the error as a function of
        $x$.  Try plotting this against $x$.  
        
        \item Calculate the maximal error.  Decrease $h$ and repeat. Confirm that the error is $O(h)$.
    \end{enumerate}

    \item Now write the \textit{euler.m} function, similar to \textit{trapez.m}. It’s output needs
    to be two array of values $x$ and $y$.  This must include the first line: $function[x,y] =
    euler(f,?,?,...)$. This should implement the Euler method for the function $y^\prime=f(x,y)$, given an
    initial condition.  
    
    You must first decide what arguments the function euler requires. One of these will have to be
    the function $f$ from the differential equation, hence try $function [x,y] = euler(f,?,?,...)$
    The initial condition might be useful: one or two arguments?  Also consider, step-size
    $h$, and the final value of $x$.

    \item Now write a second file, a script which has lines of code calling \textit{euler.m}, and
    some other lines, like the script you see in \textit{trapez-second}. 

    In the script you should alsocreate an array of exact solutions \textit{exact(x)} corresponding
    to the same values of $x$ which the \textit{euler.m} function returns. This needs to be done as
    in \textit{(a)}.
    
    \item Now do an error analysis similar to that done in \textit{trapez-second}. We know to expect
    an error of $O(h)$ so you know what the gradient of the log/log plot should be. Think about:
    \begin{enumerate}
        \item How you would decrease the step-size in a sensible way.
        \item For each step-siz to do an error analysis as in (c) and obtain the log/log plot.
    \end{enumerate} 
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Exercise 2}

Repeat all of the above with another differential equation of the form $y^\prime=f(x,y)$ wit initial
condition $y(x_0)=y_0$.  
\begin{enumerate}
    \item Find your own, or try $y^\prime + y=e^x$ with initial condition $y(0)=0$. 
    
    This is linear, first order, easy to solve!

    \item Apply Euler’s method, compare with the exact solution, carry out the error analysis.
\end{enumerate} 
    
\end{document}